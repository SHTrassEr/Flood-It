// Generated by CoffeeScript 1.2.1-pre
(function() {
  var FloodIt, root;

  root = typeof exports !== "undefined" && exports !== null ? exports : this;

  if (root.FloodIt === void 0) root.FloodIt = {};

  FloodIt = root.FloodIt;

  FloodIt.Point = (function() {

    Point.name = 'Point';

    function Point(rowIndex, columnIndex) {
      this.rowIndex = rowIndex;
      this.columnIndex = columnIndex;
    }

    Point.prototype.left = function() {
      return new FloodIt.Point(this.rowIndex, this.columnIndex - 1);
    };

    Point.prototype.right = function() {
      return new FloodIt.Point(this.rowIndex, this.columnIndex + 1);
    };

    Point.prototype.up = function() {
      return new FloodIt.Point(this.rowIndex - 1, this.columnIndex);
    };

    Point.prototype.down = function() {
      return new FloodIt.Point(this.rowIndex + 1, this.columnIndex);
    };

    return Point;

  })();

  FloodIt.PlayGround = (function() {

    PlayGround.name = 'PlayGround';

    function PlayGround(rowCount, columnCount) {
      var columnIndex, rowIndex, _i, _j, _ref, _ref2;
      this.rowCount = rowCount;
      this.columnCount = columnCount;
      this.playGround = [];
      for (rowIndex = _i = 0, _ref = this.rowCount - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; rowIndex = 0 <= _ref ? ++_i : --_i) {
        this.playGround.push([]);
        for (columnIndex = _j = 0, _ref2 = this.columnCount - 1; 0 <= _ref2 ? _j <= _ref2 : _j >= _ref2; columnIndex = 0 <= _ref2 ? ++_j : --_j) {
          this.playGround[rowIndex].push(0);
        }
      }
    }

    PlayGround.prototype.isPointInPlayGround = function(pointToCell) {
      if (!pointToCell instanceof FloodIt.Point) {
        throw new Error("ArgumentException: pointToCell is not instance of FloodIt.Point");
      }
      if (pointToCell.columnIndex < 0 || pointToCell.columnIndex >= this.columnCount) {
        return false;
      }
      if (pointToCell.rowIndex < 0 || pointToCell.rowIndex >= this.rowCount) {
        return false;
      }
      return true;
    };

    PlayGround.prototype.getCellValue = function(pointToCell) {
      if (this.isPointInPlayGround(pointToCell) === true) {
        return this.playGround[pointToCell.rowIndex][pointToCell.columnIndex];
      } else {
        throw new Error("ArgumentException: pointToCell");
      }
    };

    PlayGround.prototype.setCellValue = function(pointToCell, value) {
      if (this.isPointInPlayGround(pointToCell) === true) {
        this.playGround[pointToCell.rowIndex][pointToCell.columnIndex] = value;
        return value;
      } else {
        throw new Error("ArgumentException: pointToCell");
      }
    };

    return PlayGround;

  })();

  FloodIt.Player = (function() {

    Player.name = 'Player';

    function Player(name, startPoint) {
      this.name = name;
      this.startPoint = startPoint;
    }

    return Player;

  })();

  FloodIt.Game = (function() {

    Game.name = 'Game';

    function Game() {
      this.rowCount = 10;
      this.columnCount = 20;
      this.colorsCount = 4;
      this.playGround = null;
      this.playersCount = 2;
      this.players = [new FloodIt.Player("Player1"), new FloodIt.Player("Player2")];
      this.currentPlayerId = 0;
    }

    return Game;

  })();

  FloodIt.core = (function() {
    var floodFill;

    core.name = 'core';

    function core() {}

    floodFill = function(playGround, currentPoint, targetValue, replacementValue) {
      if (!playGround.isPointInPlayGround(currentPoint)) return;
      if (playGround.getCellValue(currentPoint) !== targetValue) return;
      playGround.setCellValue(currentPoint, replacementValue);
      floodFill(playGround, currentPoint.left(), targetValue, replacementValue);
      floodFill(playGround, currentPoint.right(), targetValue, replacementValue);
      floodFill(playGround, currentPoint.up(), targetValue, replacementValue);
      return floodFill(playGround, currentPoint.down(), targetValue, replacementValue);
    };

    core.flood = function(playGround, startPoint, replacementValue) {
      if (playGround.getCellValue(startPoint) === replacementValue) return;
      floodFill(playGround, startPoint, playGround.getCellValue(startPoint), replacementValue);
      return playGround;
    };

    return core;

  })();

  FloodIt.Map = (function() {
    var fillPlayGround, initPlayers;

    Map.name = 'Map';

    function Map() {}

    fillPlayGround = function(game) {
      var columnIndex, rowIndex, _i, _ref, _results;
      _results = [];
      for (rowIndex = _i = 0, _ref = game.rowCount - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; rowIndex = 0 <= _ref ? ++_i : --_i) {
        _results.push((function() {
          var _j, _ref2, _results2;
          _results2 = [];
          for (columnIndex = _j = 0, _ref2 = game.columnCount - 1; 0 <= _ref2 ? _j <= _ref2 : _j >= _ref2; columnIndex = 0 <= _ref2 ? ++_j : --_j) {
            _results2.push(game.playGround.setCellValue(new FloodIt.Point(rowIndex, columnIndex), Math.floor(Math.random() * game.colorsCount)));
          }
          return _results2;
        })());
      }
      return _results;
    };

    initPlayers = function(game) {
      game.players[0].startPoint = new FloodIt.Point(0, 0);
      return game.players[1].startPoint = new FloodIt.Point(game.rowCount - 1, game.columnCount - 1);
    };

    Map.init = function(game) {
      game.playGround = new FloodIt.PlayGround(game.rowCount, game.columnCount);
      fillPlayGround(game);
      return initPlayers(game);
    };

    return Map;

  })();

  FloodIt.Engine = (function() {

    Engine.name = 'Engine';

    function Engine() {}

    Engine.step = function(game, selectedValue) {
      FloodIt.core.flood(game.playGround, game.players[game.currentPlayerId].startPoint, selectedValue);
      return FloodIt.Engine.switchPlayer(game);
    };

    Engine.switchPlayer = function(game) {
      if (game.currentPlayerId < game.playersCount - 1) {
        return game.currentPlayerId++;
      } else {
        return game.currentPlayerId = 0;
      }
    };

    return Engine;

  })();

}).call(this);
